#!/usr/bin/env bash
set -xeu

# Default to showing the prompt
show_prompt=true
if [[ "$1" == "--silent" ]]; then
    show_prompt=false
    shift
fi

cmd="$*"

inner_cmd=""

if $show_prompt; then
    inner_cmd+="echo \> '$cmd';"
fi

inner_cmd+="$cmd;"

if $show_prompt; then
    inner_cmd+="echo 'Done! Press any key to close...'; read -n 1 -s"
else
    inner_cmd+="if [ \$? -ne 0 ]; then echo 'Failed! press any key to close...'; read -n 1 -s; fi"
fi

exec setsid uwsm app -- $TERMINAL_CLEAN --class=System -e bash -c "$inner_cmd"
